app-id: org.gnome.gThumb
runtime: org.gnome.Platform
runtime-version: '48'
sdk: org.gnome.Sdk

# Upstream flatpak manifest
# https://gitlab.gnome.org/GNOME/gthumb/-/blob/master/data/flatpak/org.gnome.gThumb.yml

command: gthumb

finish-args:
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --socket=wayland
  - --device=dri
  - --share=ipc
  - --talk-name=org.freedesktop.secrets
  - --filesystem=xdg-public-share
  - --filesystem=xdg-pictures
  - --filesystem=xdg-run/gvfs
  - --filesystem=xdg-run/gvfsd
  - --talk-name=org.gtk.vfs.*
  - --talk-name=org.gtk.MountOperationHandler

cleanup:
  - /include
  - /lib/pkgconfig
  - /lib/cmake
  - /lib/girepository-*
  - /share/vala
  - '*.a'
  - '*.la'

modules:
  - name: exiv2
    buildsystem: cmake-ninja
    cleanup:
      - /lib/exiv2
      - /share/man
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DEXIV2_BUILD_EXIV2_COMMAND=OFF
      - -DEXIV2_BUILD_SAMPLES=OFF
      - -DEXIV2_BUILD_UNIT_TESTS=OFF
      - -DEXIV2_ENABLE_INIH=OFF
    sources:
      - type: archive
        url: https://github.com/Exiv2/exiv2/archive/refs/tags/v0.28.7.tar.gz
        sha256: 5e292b02614dbc0cee40fe1116db2f42f63ef6b2ba430c77b614e17b8d61a638
        x-checker-data:
          type: anitya
          project-id: 769
          stable-only: true
          url-template: https://github.com/Exiv2/exiv2/archive/refs/tags/v$version.tar.gz

  - name: colord
    modules:
      - shared-modules/libusb/libusb.json
      - name: gusb
        buildsystem: meson
        config-opts:
          - -Ddocs=false
          - -Dvapi=false
          - -Dtests=false
        cleanup:
          - /bin/gusbcmd
        sources:
          - type: archive
            url: https://github.com/hughsie/libgusb/releases/download/0.4.9/libgusb-0.4.9.tar.xz
            sha256: 9df5ef301d6a4b361002aa52cce1165a87a89744055879bdbab31e7e86f1e846
    buildsystem: meson
    config-opts:
      - -Dargyllcms_sensor=false
      - -Dbash_completion=false
      - -Ddocs=false
      - -Dman=false
      - -Dtests=false
      - -Dinstalled_tests=false
      - -Dudev_rules=false
      - -Dsystemd=false
    sources:
      - type: archive
        url: https://www.freedesktop.org/software/colord/releases/colord-1.4.8.tar.xz
        sha256: 21500bd68975312a7f0f3ce6019d9f75f42aacaa75ca7115ec720b5445406896
        x-checker-data:
          type: anitya
          project-id: 10190
          stable-only: true
          url-template: https://www.freedesktop.org/software/colord/releases/colord-$version.tar.xz

  - name: libheif
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_COMPILE_WARNING_AS_ERROR=OFF
      - -DCMAKE_DISABLE_FIND_PACKAGE_Doxygen=ON
      - -DBUILD_TESTING=OFF
      - -DWITH_EXAMPLES=OFF
    cleanup:
      - /bin
      - /share/man
    modules:
      - name: libde265
        config-opts:
          - --disable-sherlock265
        cleanup:
          - /bin
        sources:
          - type: archive
            url: https://github.com/strukturag/libde265/releases/download/v1.0.15/libde265-1.0.15.tar.gz
            sha256: 00251986c29d34d3af7117ed05874950c875dd9292d016be29d3b3762666511d
    sources:
      - type: archive
        url: https://github.com/strukturag/libheif/releases/download/v1.20.2/libheif-1.20.2.tar.gz
        sha256: 68ac9084243004e0ef3633f184eeae85d615fe7e4444373a0a21cebccae9d12a
        x-checker-data:
          type: anitya
          project-id: 64439
          stable-only: true
          url-template: https://github.com/strukturag/libheif/releases/download/v$version/libheif-$version.tar.gz

  - name: libraw
    buildsystem: autotools
    config-opts:
      - --disable-examples
    sources:
      - type: archive
        url: https://www.libraw.org/data/LibRaw-0.21.4.tar.gz
        sha256: 6be43f19397e43214ff56aab056bf3ff4925ca14012ce5a1538a172406a09e63
        x-checker-data:
          type: anitya
          project-id: 1709
          stable-only: true
          url-template: https://www.libraw.org/data/LibRaw-$version.tar.gz
    cleanup:
      - /share/doc

  - name: totem-pl-parser
    buildsystem: meson
    config-opts:
      - -Dbuildtype=release
    sources:
      - type: archive
        url: https://download.gnome.org/sources/totem-pl-parser/3.26/totem-pl-parser-3.26.6.tar.xz
        sha256: c0df0f68d5cf9d7da43c81c7f13f11158358368f98c22d47722f3bd04bd3ac1c

  - name: totem-video-thumbnailer
    buildsystem: meson
    config-opts:
      - -Dbuildtype=release
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/totem-video-thumbnailer.git
        commit: 6cb399918571a97591ff5a4a5a41d8e46b11027a

  # This module requires a lot of resources and time to be built, hence it's moved outside the main manifest so it can be easily commented and disabled for local tests.
  - webkit2gtk.yaml

  - name: gThumb
    buildsystem: meson
    config-opts:
      - -Dbuildtype=release
      - -Dflatpak-build=true
      - -Dwarn-deprecated=false
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gthumb/3.12/gthumb-3.12.8.tar.xz
        sha256: afc74a271f6017b7581319efc8b8ab56400990ab9d200160a4efa6fcbe2274f2
        x-checker-data:
          type: gnome
          name: gthumb
          stable-only: true
      # https://gitlab.gnome.org/GNOME/gthumb/-/commit/816883e1d74c4d3f7b379205876a54d45accace9
      - type: patch
        path: gthumb-3.12.8.patch
    cleanup:
      - /share/aclocal

